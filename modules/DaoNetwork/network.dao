
load DaoNetwork;

class @Server
{
	routine Start()
	{
#	io.println( network.gethost( '127.0.0.1' ) );
		io.println( network.gethost( 'localhost' ) );
		sock = network.bind( 10000 );
		sock.listen();
		while(1){
			sockfd = sock.accept();
			message = sockfd.receive();
			io.println( sockfd.peername() );
			io.println( 'received', message );
			sockfd.send_dao( 'TEST', 12.345, [1,2,3] );
			sockfd.close();
			break;
		}
	}
}

class @Client
{
	routine Start()
	{
		sockfd = network.connect( 'localhost', 10000 );
		io.writeln( 'sending' );
		sockfd.send( 'TEST' );
		message = sockfd.receive_dao();
		io.println( 'received', message );
		sockfd.close();
	}
}
#std.listmeth( network );
#io.println( network );

server = Server();
server.Start();
sys.sleep(1);
client = Client();
client.Start();
